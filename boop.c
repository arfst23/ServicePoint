//******************************************************************************
 
#include "display.h"

#include <stdlib.h>
#include <stdint.h>
#include <stdbool.h>

#define BOARD_SIZE 6
#define SYMBOL_TILES_HORIZ 4
#define SYMBOL_TILES_VERT 3

#define OFFSET_TILES_X 15
#define OFFSET_TILES_Y 1
#define OFFSET_X (OFFSET_TILES_X * DISPLAY_TILE_SIZE)
#define OFFSET_Y (OFFSET_TILES_Y * DISPLAY_TILE_SIZE)
#define CELL_STEP (SYMBOL_TILES_HORIZ * DISPLAY_TILE_SIZE)
#define CELL_WIDTH ((SYMBOL_TILES_HORIZ - 1) * DISPLAY_TILE_SIZE)
#define CELL_HEIGHT (SYMBOL_TILES_VERT * DISPLAY_TILE_SIZE)

//******************************************************************************
// >>> board_symbol_bits

static int const board_symbol_bits[4][18] =
{
  { // 0
    0b0000000000000000000000,
    0b0000000000000000000000,
    0b0011000000000000001100,
    0b0001100000000000011000,
    0b0001100000000000011000,
//  0b0000110000000000110000,
//  0b0000011000000001100000,
//  0b0000011000000001100000,
//  0b0000001100000011000000,
    0b0000000110000110000000,
    0b0000000110000110000000,
    0b0000000011001100000000,
    0b0000000001111000000000,
    0b0000000001111000000000,
    0b0000000011001100000000,
    0b0000000110000110000000,
    0b0000000110000110000000,
//  0b0000001100000011000000,
//  0b0000011000000001100000,
//  0b0000011000000001100000,
//  0b0000110000000000110000,
    0b0001100000000000011000,
    0b0001100000000000011000,
    0b0011000000000000001100,
    0b0000000000000000000000,
    0b0000000000000000000000,
  },
  { // 1
    0b1110000000000000000111,
    0b1110000000000000000111,
    0b0111000000000000001110,
    0b0011100000000000011100,
    0b0011100000000000011100,
//  0b0001110000000000111000,
//  0b0000111000000001110000,
//  0b0000111000000001110000,
//  0b0000011100000011100000,
    0b0000001110000111000000,
    0b0000001110000111000000,
    0b0000000111001110000000,
    0b0000000011111100000000,
    0b0000000011111100000000,
    0b0000000111001110000000,
    0b0000001110000111000000,
    0b0000001110000111000000,
//  0b0000011100000011100000,
//  0b0000111000000001110000,
//  0b0000111000000001110000,
//  0b0001110000000000111000,
    0b0011100000000000011100,
    0b0011100000000000011100,
    0b0111000000000000001110,
    0b1110000000000000000111,
    0b1110000000000000000111,
  },
  { // 2
    0b0000000000000000000000,
    0b0000000000000000000000,
    0b0000000011111100000000,
    0b0000001111111111000000,
    0b0000011100000011100000,
//  0b0000110000000000110000,
//  0b0000110000000000110000,
//  0b0000110000000000110000,
//  0b0001100000000000011000,
    0b0001100000000000011000,
    0b0001100000000000011000,
    0b0011000000000000001100,
    0b0011000000000000001100,
    0b0011000000000000001100,
    0b0011000000000000001100,
    0b0001100000000000011000,
    0b0001100000000000011000,
//  0b0001100000000000011000,
//  0b0000110000000000110000,
//  0b0000110000000000110000,
//  0b0000110000000000110000,
    0b0000011100000011100000,
    0b0000001111111111000000,
    0b0000000011111100000000,
    0b0000000000000000000000,
    0b0000000000000000000000,
  },
  { // 3
    0b0000000011111100000000,
    0b0000001111111111000000,
    0b0000111111111111110000,
    0b0001111100000011111000,
    0b0001110000000000111000,
//  0b0011100000000000011100,
//  0b0011100000000000011100,
//  0b0011100000000000011100,
//  0b0111000000000000001110,
    0b0111000000000000001110,
    0b0111000000000000001110,
    0b1110000000000000000111,
    0b1110000000000000000111,
    0b1110000000000000000111,
    0b1110000000000000000111,
    0b0111000000000000001110,
    0b0111000000000000001110,
//  0b0111000000000000001110,
//  0b0011100000000000011100,
//  0b0011100000000000011100,
//  0b0011100000000000011100,
    0b0001110000000000111000,
    0b0001111100000011111000,
    0b0000111111111111110000,
    0b0000001111111111000000,
    0b0000000011111100000000,
  },
};

// <<<
//******************************************************************************
// >>> board

static void board_frame()
{
  for (int x = -10; x < BOARD_SIZE * CELL_STEP - DISPLAY_TILE_SIZE + 10; x++)
  {
    for (int y = -4; y < 0; y++)
      display_set(x + OFFSET_X, y + OFFSET_Y, true);
    for (int y = 1; y <= 4; y++)
      display_set(x + OFFSET_X, y + OFFSET_Y + BOARD_SIZE * CELL_HEIGHT, true);
  }

  for (int y = 0; y < BOARD_SIZE * CELL_HEIGHT; y++)
  {
    for (int x = -10; x < -6; x++)
      display_set(x + OFFSET_X, y + OFFSET_Y, true);
    for (int x = 6 - 1; x < 10; x++)
      display_set(x + OFFSET_X + BOARD_SIZE * CELL_STEP - DISPLAY_TILE_SIZE, y + OFFSET_Y, true);
  }

  for (int row = 0; row < BOARD_SIZE; row++)
    for (int col = 0; col < BOARD_SIZE; col++)
    {
      int x0 = OFFSET_X + col * CELL_STEP;
      int y0 = OFFSET_Y + row * CELL_HEIGHT;

      for (int x = -2; x < CELL_WIDTH + 1; x++)
      {
	display_set(x + x0, 0 + y0, true);
	display_set(x + x0, CELL_HEIGHT - 1 + y0, true);
      }board_symbol_bits

      for (int y = 0; y < CELL_WIDTH; y++)
      {
	display_set(-2 + x0, y + y0, true);
	display_set(CELL_WIDTH + 1 + x0, y + y0, true);
      }
    }
}

static void board_symbol(int row, int col, int symbol)
{
  int x0 = OFFSET_X + col * CELL_STEP + 1;
  int y0 = OFFSET_Y + row * CELL_HEIGHT + 3;
  for (int y = 0; y < 18; y++)
  {
    int bits = symbol ? board_symbol_bits[symbol - 1][y] : 0;
    for (int x = 0; x < 22; x++)
      display_set(x + x0, y + y0, (bits << x) & (1 << (22 - 1)));
  }
}

// <<<
//******************************************************************************

static const int player_symbol_bits[6][8] =
{
  { // 0
    0b00000000,
    0b01000010,
    0b00100100,
    0b00011000,
    0b00011000,
    0b00100100,
    0b01000010,
    0b00000000,
  },
  { // 0
    0b11000011,
    0b11000011,
    0b01100110,
    0b00111100,
    0b00111100,
    0b01100110,
    0b11000011,
    0b11000011,
  },
  { // 0
    0b00000000,
    0b00111100,
    0b01000010,
    0b01000010,
    0b01000010,
    0b01000010,
    0b00111100,
    0b00000000,
  },
  { // 0
    0b00111100,
    0b01111110,
    0b11100111,
    0b11000011,
    0b11000011,
    0b11100111,
    0b01111110,
    0b00111100,
  },
  { // 0
    0b11000000,
    0b11110000,
    0b11111100,
    0b11111111,
    0b11111100,
    0b11110000,
    0b11000000,
    0b00000000,
  },
  { // 0
    0b11100111,
    0b11100111,
    0b11100111,
    0b11100111,
    0b11100111,
    0b11100111,
    0b11100111,
    0b00000000,
  },
};

static void player_frame()
{
  
}

static void player_symbol(int player, int row, int symbol)
{
  
}

//******************************************************************************

int main(int ac, const char *av[])
{
  int display_select
      = ac == 1 ? DISPLAY_SELECT_GX | DISPLAY_SELECT_SP
      : av[1][0] == 'g' ? DISPLAY_SELECT_GX
      : av[1][0] == 's' ? DISPLAY_SELECT_SP
      : 0;
  display_create(display_select);

  board_frame();
  board_symbol(0, 0, 1);
  board_symbol(0, 1, 2);
  board_symbol(1, 0, 3);
  board_symbol(1, 1, 4);
  display_flush();

  display_wait();
  display_free();
  return EXIT_SUCCESS;
}

//******************************************************************************
